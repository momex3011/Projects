<!DOCTYPE html>
<html lang="{{ get_locale() }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ _('Al-Nabk City Civil Council') }}{% endblock %}</title>
    <link rel="icon" href="{{ url_for('static', filename='Al-nabak-square-symbol.png') }}">

    {# === START: Inline script to set theme immediately === #}
    <script>
      (function() {
        try {
          var theme = localStorage.getItem('theme');
          if (theme === 'dark') {
            document.documentElement.classList.add('dark-mode');
          } else {
             document.documentElement.classList.remove('dark-mode');
          }
        } catch (e) {
          console.error("Could not access localStorage for theme setting.", e);
        }
      })();
    </script>
    {# === END: Inline script === #}

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    {% block head %}{% endblock %}

    <style>
        /* Basic screen reader only class */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap; /* Add this */
            border-width: 0; /* Add this */
        }
    </style>

</head>
<body>
    <nav class="navbar">
        <a class="navbar-brand" href="{{ url_for('dashboard', locale=get_locale()) }}">{{ _('Al-Nabk City Civil Council') }}</a>
        <ul class="navbar-nav">
            <li class="nav-item"><a class="nav-link" href="{{ url_for('projects_list', locale=get_locale()) }}">{{ _('Projects') }}</a></li>
            {% if current_user.is_authenticated %}
                <li class="nav-item"><a class="nav-link" href="{{ url_for('calendar', locale=get_locale()) }}">{{ _('Calendar') }}</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('edit_profile', locale=get_locale()) }}">{{ _('Edit Profile') }}</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('logout', locale=get_locale()) }}">{{ _('Logout') }}</a></li>
            {% else %}
                <li class="nav-item"><a class="nav-link" href="{{ url_for('login', locale=get_locale()) }}">{{ _('Login') }}</a></li>
            {% endif %}
            <li class="nav-item">
                <button id="theme-toggle" class="theme-toggle">
                    <i class="fas fa-moon"></i>
                </button>
            </li>
            {# === START: Updated Language Switcher === #}
            <li class="nav-item language-switch-header">
                {% set current_locale = get_locale() %}
                {% if current_locale == 'en' %}
                    {# If current is English, link to Arabic #}
                    <a href="{{ url_for('set_language', locale='ar') }}" class="nav-link" title="{{ _('Switch to Arabic') }}">
                        <i class="fas fa-globe"></i> <span class="sr-only">{{ _('Switch to Arabic') }}</span>
                    </a>
                {% else %}
                    {# If current is not English (assume Arabic), link to English #}
                    <a href="{{ url_for('set_language', locale='en') }}" class="nav-link" title="{{ _('Switch to English') }}">
                        <i class="fas fa-globe"></i> <span class="sr-only">{{ _('Switch to English') }}</span>
                    </a>
                {% endif %}
            </li>
            {# === END: Updated Language Switcher === #}
        </ul>
    </nav>
    <div class="content">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="container">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
    </div>
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section about">
                <h3>{{ _('About Al-Nabk City Civil Council') }}</h3>
                <p>{{ _('Welcome to the official website of the Al-Nabk City Civil Council, established after the end of the civil war to serve as the voice of all the residents of our city. We are committed to working hand in hand with you to build a better future that reflects the aspirations of everyone.') }}</p>
                <p>{{ _('The Al-Nabk City Civil Council aims to promote transparency in managing the city’s affairs, encourage community collaboration and participation in decision-making, improve infrastructure and public services to meet residents\' needs, and support efforts to rebuild the city and restore its prosperity.') }}</p>
                <p>{{ _('We invite you to contribute your ideas and suggestions to achieve a shared vision for our beloved city. You can contact us directly through the website, participate in surveys, and stay updated on the latest news and projects. Together, we build the future of Al-Nabk!') }}</p>
            </div>
            <div class="footer-section center-links">
                <div class="footer-section links">
                    <h3>{{ _('Quick Links') }}</h3>
                    <ul>
                        <li><a href="#">{{ _('Terms of Service') }}</a></li>
                        <li><a href="#">{{ _('Privacy Policy') }}</a></li>
                    </ul>
                </div>
                {# Keep the footer language switcher as is #}
                <div class="footer-section language-switch-footer">
                    <h3>{{ _('Language') }}</h3>
                    <div class="language-buttons">
                        <a href="{{ url_for('set_language', locale='en') }}" class="btn btn-sm">{{ _('EN') }}</a>
                        <a href="{{ url_for('set_language', locale='ar') }}" class="btn btn-sm">{{ _('AR') }}</a>
                    </div>
                </div>
            </div>
            <div class="footer-section social">
                <h3>{{ _('Follow Us') }}</h3>
                <div class="social-links">
                    <a href="https://www.instagram.com/" target="_blank" rel="noopener noreferrer" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="https://wa.me/" target="_blank" rel="noopener noreferrer" aria-label="Whatsapp"><i class="fab fa-whatsapp"></i></a>
                    <a href="#" target="_blank" rel="noopener noreferrer" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                    <a href="#" target="_blank" rel="noopener noreferrer" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© {{ year }} {{ _('Al-Nabk City Civil Council. All rights reserved.') }}</p> {# Note: year variable might need to be passed from Flask #}
        </div>
    </footer>
    <script src="{{ url_for('static', filename='main.js') }}"></script>
</body>
</html>